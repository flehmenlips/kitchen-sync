import{g as we,a as ze,r as o,_ as oe,b as Oe,c as q,u as Fe,j as e,s as We,d as qe,e as he,f as Ee,B as Ue,h as W,i as A,k as Q,D as E,l as U,m as L,n as c,R as Le,F as G,o as Y,p as C,T as N,q as me,I as ge,S as ye,M as ve,t as J,v as m,w as V,P as je,L as fe,x as be,y as Ce,z as Se,A as Ne,C as Ve,E as Ae,G as Qe,H as K,J as He,K as Ge,N as Ye,O as de,Q as ce,U as T,V as Ke,W as z,X as Je,Y as Xe,Z as Ze,$ as ue,a0 as et,a1 as tt}from"./index-C_8l1QQ3.js";function st(s){return ze("MuiToggleButton",s)}const pe=we("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),at=o.createContext({}),nt=o.createContext(void 0);function it(s,a){return a===void 0||s===void 0?!1:Array.isArray(a)?a.indexOf(s)>=0:s===a}const rt=["value"],lt=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],ot=s=>{const{classes:a,fullWidth:t,selected:r,disabled:l,size:u,color:h}=s,S={root:["root",r&&"selected",l&&"disabled",t&&"fullWidth",`size${he(u)}`,h]};return Ee(S,st,a)},dt=We(Ue,{name:"MuiToggleButton",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:t}=s;return[a.root,a[`size${he(t.size)}`]]}})(({theme:s,ownerState:a})=>{let t=a.color==="standard"?s.palette.text.primary:s.palette[a.color].main,r;return s.vars&&(t=a.color==="standard"?s.vars.palette.text.primary:s.vars.palette[a.color].main,r=a.color==="standard"?s.vars.palette.text.primaryChannel:s.vars.palette[a.color].mainChannel),q({},s.typography.button,{borderRadius:(s.vars||s).shape.borderRadius,padding:11,border:`1px solid ${(s.vars||s).palette.divider}`,color:(s.vars||s).palette.action.active},a.fullWidth&&{width:"100%"},{[`&.${pe.disabled}`]:{color:(s.vars||s).palette.action.disabled,border:`1px solid ${(s.vars||s).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:s.vars?`rgba(${s.vars.palette.text.primaryChannel} / ${s.vars.palette.action.hoverOpacity})`:W(s.palette.text.primary,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${pe.selected}`]:{color:t,backgroundColor:s.vars?`rgba(${r} / ${s.vars.palette.action.selectedOpacity})`:W(t,s.palette.action.selectedOpacity),"&:hover":{backgroundColor:s.vars?`rgba(${r} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.hoverOpacity}))`:W(t,s.palette.action.selectedOpacity+s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:s.vars?`rgba(${r} / ${s.vars.palette.action.selectedOpacity})`:W(t,s.palette.action.selectedOpacity)}}}},a.size==="small"&&{padding:7,fontSize:s.typography.pxToRem(13)},a.size==="large"&&{padding:15,fontSize:s.typography.pxToRem(15)})}),ct=o.forwardRef(function(a,t){const r=o.useContext(at),{value:l}=r,u=oe(r,rt),h=o.useContext(nt),S=Oe(q({},u,{selected:it(a.value,l)}),a),v=Fe({props:S,name:"MuiToggleButton"}),{children:D,className:d,color:j="standard",disabled:p=!1,disableFocusRipple:R=!1,fullWidth:I=!1,onChange:b,onClick:y,selected:M,size:n="medium",value:$}=v,k=oe(v,lt),P=q({},v,{color:j,disabled:p,disableFocusRipple:R,fullWidth:I,size:n}),O=ot(P),H=_=>{y&&(y(_,$),_.defaultPrevented)||b&&b(_,$)},w=h||"";return e.jsx(dt,q({className:qe(u.className,O.root,d,w),disabled:p,focusRipple:!R,ref:t,onClick:H,onChange:b,value:$,ownerState:P,"aria-pressed":M},k,{children:D}))});var X={},ut=A;Object.defineProperty(X,"__esModule",{value:!0});var Ie=X.default=void 0,pt=ut(Q()),xt=e;Ie=X.default=(0,pt.default)((0,xt.jsx)("path",{d:"M14 11V8c4.56-.58 8-3.1 8-6H2c0 2.9 3.44 5.42 8 6v3c-3.68.73-8 3.61-8 11h6v-2H4.13c.93-6.83 6.65-7.2 7.87-7.2s6.94.37 7.87 7.2H16v2h6c0-7.39-4.32-10.27-8-11m-2 11c-1.1 0-2-.9-2-2 0-.55.22-1.05.59-1.41C11.39 17.79 16 16 16 16s-1.79 4.61-2.59 5.41c-.36.37-.86.59-1.41.59"}),"Scale");var Z={},ht=A;Object.defineProperty(Z,"__esModule",{value:!0});var Re=Z.default=void 0,mt=ht(Q()),gt=e;Re=Z.default=(0,mt.default)((0,gt.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var ee={},yt=A;Object.defineProperty(ee,"__esModule",{value:!0});var $e=ee.default=void 0,vt=yt(Q()),jt=e;$e=ee.default=(0,vt.default)((0,jt.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var te={},ft=A;Object.defineProperty(te,"__esModule",{value:!0});var ke=te.default=void 0,bt=ft(Q()),Ct=e;ke=te.default=(0,bt.default)((0,Ct.jsx)("path",{d:"M19 5v14H5V5zm1.1-2H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9M11 7h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7z"}),"ListAlt");const St=[2,3,4],It=[2,3,4],Rt=({open:s,onClose:a,onScale:t,ingredients:r})=>{var M;const[l,u]=o.useState("multiply"),[h,S]=o.useState(2),[v,D]=o.useState(2),[d,j]=o.useState(""),[p,R]=o.useState(""),[I,b]=o.useState(""),y=()=>{var $;let n;switch(l){case"multiply":n=d?parseFloat(d):h;break;case"divide":n=d?1/parseFloat(d):1/v;break;case"constraint":if(!p||!I)return;const k=r.find(P=>P.id===p);if(!k)return;n=parseFloat(I)/k.quantity;break;default:return}t({type:l,value:n,constraintIngredientId:l==="constraint"?Number(p):void 0,constraintQuantity:l==="constraint"?parseFloat(I):void 0,constraintUnitId:l==="constraint"&&p?($=r.find(k=>k.id===p))==null?void 0:$.unit.id:void 0}),a()};return e.jsxs(E,{open:s,onClose:a,maxWidth:"sm",fullWidth:!0,children:[e.jsx(U,{children:"Scale Recipe"}),e.jsx(L,{children:e.jsxs(c,{sx:{pt:1},children:[e.jsxs(Le,{value:l,onChange:n=>{u(n.target.value),j("")},children:[e.jsx(G,{value:"multiply",control:e.jsx(Y,{}),label:"Multiply Recipe"}),l==="multiply"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsx(c,{sx:{display:"flex",gap:1,mb:1},children:St.map(n=>e.jsxs(C,{variant:h===n&&!d?"contained":"outlined",onClick:()=>{S(n),j("")},size:"small",children:[n,"x"]},n))}),e.jsx(N,{label:"Custom multiplier",type:"number",value:d,onChange:n=>j(n.target.value),size:"small",inputProps:{min:"0",step:"0.25"}})]}),e.jsx(G,{value:"divide",control:e.jsx(Y,{}),label:"Divide Recipe"}),l==="divide"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsx(c,{sx:{display:"flex",gap:1,mb:1},children:It.map(n=>e.jsxs(C,{variant:v===n&&!d?"contained":"outlined",onClick:()=>{D(n),j("")},size:"small",children:["1/",n]},n))}),e.jsx(N,{label:"Custom divider",type:"number",value:d,onChange:n=>j(n.target.value),size:"small",inputProps:{min:"0",step:"0.25"}})]}),e.jsx(G,{value:"constraint",control:e.jsx(Y,{}),label:"Scale Based on Ingredient"}),l==="constraint"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsxs(me,{fullWidth:!0,size:"small",sx:{mb:1},children:[e.jsx(ge,{children:"Base Ingredient"}),e.jsx(ye,{value:p,onChange:n=>R(n.target.value),label:"Base Ingredient",children:r.map(n=>e.jsxs(ve,{value:n.id,children:[n.name," (",n.quantity," ",n.unit.name,")"]},n.id))})]}),p&&e.jsx(N,{label:"Desired Quantity",type:"number",value:I,onChange:n=>b(n.target.value),size:"small",fullWidth:!0,InputProps:{endAdornment:(M=r.find(n=>n.id===p))==null?void 0:M.unit.name},inputProps:{min:"0",step:"0.25"}})]})]}),e.jsx(J,{sx:{my:2}}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Note: The scaling engine will intelligently round certain ingredients (like eggs) to maintain practical measurements while preserving the recipe's proportions."})]})}),e.jsxs(V,{children:[e.jsx(C,{onClick:a,children:"Cancel"}),e.jsx(C,{onClick:y,variant:"contained",disabled:l==="constraint"&&(!p||!I)||l!=="constraint"&&!d&&!h&&!v,children:"Scale Recipe"})]})]})},xe=({name:s,ingredients:a,yieldQuantity:t,yieldUnit:r,isScaled:l,scaleFactor:u})=>e.jsxs(je,{sx:{p:2,height:"100%"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"baseline",mb:2,borderBottom:"2px solid",borderColor:"divider",pb:1},children:[e.jsxs(m,{variant:"h6",component:"h2",sx:{fontWeight:"bold"},children:[s,l&&` (${u}x)`]}),e.jsxs(m,{variant:"subtitle1",color:"text.secondary",children:["Yield: ",t," ",(r==null?void 0:r.name)||"servings"]})]}),e.jsx(fe,{dense:!0,disablePadding:!0,children:a.map((h,S)=>{var v;return e.jsxs(be.Fragment,{children:[S>0&&e.jsx(J,{}),e.jsx(Ce,{dense:!0,disableGutters:!0,children:e.jsx(Se,{primary:e.jsxs(m,{variant:"body2",sx:{fontFamily:"monospace"},children:[e.jsx(c,{component:"span",sx:{display:"inline-block",minWidth:"4rem"},children:h.quantity}),e.jsx(c,{component:"span",sx:{display:"inline-block",minWidth:"4rem"},children:h.unit.abbreviation||h.unit.name}),((v=h.ingredient)==null?void 0:v.name)||""]}),secondary:h.note,secondaryTypographyProps:{variant:"caption",sx:{fontStyle:"italic"}}})})]},h.id)})})]}),$t=["egg","eggs","whole egg","whole eggs","banana","bananas","apple","apples","orange","oranges"],kt=[{decimal:.25,fraction:"1/4"},{decimal:.33,fraction:"1/3"},{decimal:.5,fraction:"1/2"},{decimal:.67,fraction:"2/3"},{decimal:.75,fraction:"3/4"}],_t=s=>{const a=s.name.toLowerCase();return $t.some(t=>a.includes(t))||s.unit.type==="COUNT"},Bt=s=>{if(s<.125)return s;const a=Math.floor(s),t=s-a;if(t<.125)return a;if(t>.875)return a+1;const r=kt.reduce((l,u)=>Math.abs(u.decimal-t)<Math.abs(l.decimal-t)?u:l);return a+r.decimal},Tt=(s,a)=>_t(s)?Math.round(a):Bt(a),Dt=(s,a)=>{let t=a.value;if(a.type==="constraint"&&a.constraintIngredientId&&a.constraintQuantity){const r=s.find(l=>l.id===a.constraintIngredientId);r&&(t=a.constraintQuantity/r.quantity)}return s.map(r=>{const l=r.quantity*t,u=Tt(r,l);return{...r,quantity:u,note:Math.abs(u-l)>.1?`Rounded from ${l.toFixed(2)}`:void 0}})},Pt=()=>{const{id:s}=Ne(),a=Ve(),[t,r]=o.useState(null),[l,u]=o.useState(null),[h,S]=o.useState(!0),[v,D]=o.useState(!1),[d,j]=o.useState(null),[p,R]=o.useState(1),[I,b]=o.useState(!1),[y,M]=o.useState(!1),{showSnackbar:n}=Ae(),{addTask:$,columns:k}=Qe(),[P,O]=o.useState(!1),[H,w]=o.useState(!1),[_,se]=o.useState(""),[ae,ne]=o.useState("");o.useEffect(()=>{(async()=>{try{if(!s)throw new Error("Recipe ID is required");const x=await ue(parseInt(s,10));r(x)}catch(x){u(x instanceof Error?x.message:"Failed to load recipe")}finally{S(!1)}})()},[s]);const _e=i=>{if(!(t!=null&&t.recipeIngredients))return;const x=t.recipeIngredients.map(f=>{var g;return{id:f.id,name:((g=f.ingredient)==null?void 0:g.name)||"",quantity:f.quantity,unit:{...f.unit,type:"VOLUME"}}}),B=Dt(x,i);j(t.recipeIngredients.map((f,g)=>({...f,quantity:B[g].quantity,note:B[g].note}))),R(i.value)},Be=async()=>{var i,x;if(!(!t||!d))try{const B={name:t.name,description:t.description||"",instructions:t.instructions,yieldQuantity:(t.yieldQuantity||1)*p,yieldUnitId:((i=t.yieldUnit)==null?void 0:i.id)||1,prepTimeMinutes:t.prepTimeMinutes||0,cookTimeMinutes:t.cookTimeMinutes||0,categoryId:((x=t.category)==null?void 0:x.id)||1,tags:t.tags,ingredients:d.map(g=>{var F;return{type:"ingredient",ingredientId:(F=g.ingredient)==null?void 0:F.id,quantity:g.quantity,unitId:g.unit.id}})};await et(t.id,B);const f=await ue(t.id);r(f),j(null),R(1),b(!1)}catch{u("Failed to save scaled version")}},Te=()=>{j(null),R(1)},De=()=>{se(""),ne(""),w(!0)},Me=async()=>{if(!(!t||!_))try{const i=t.id?parseInt(t.id.toString(),10):void 0;await $({title:t.name,description:ae||t.description||"",columnId:_,recipeId:i}),w(!1),n("Recipe added to prep board","success")}catch(i){console.error("Error adding recipe to prep board:",i),n("Failed to add recipe to prep board","error")}},Pe=async()=>{if(t!=null&&t.id)try{await tt(t.id),n("Recipe deleted successfully","success"),a("/recipes")}catch(i){console.error("Error deleting recipe:",i),n("Failed to delete recipe","error")}},ie=({ingredients:i,yield:x,isScaled:B=!1})=>{var f;return e.jsxs(je,{sx:{p:3,mb:3,height:"100%"},children:[B&&e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(m,{variant:"subtitle1",color:"primary",children:["Scaled Version (",p,"x)"]}),e.jsxs(c,{children:[e.jsx(T,{title:"Save as New Base Recipe",children:e.jsx(z,{onClick:()=>b(!0),color:"primary",size:"small",children:e.jsx(Re,{})})}),e.jsx(T,{title:"Close Scaled Version",children:e.jsx(z,{onClick:Te,size:"small",children:e.jsx($e,{})})})]})]}),(t==null?void 0:t.description)&&!y&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(m,{variant:"body1",paragraph:!0,children:t.description})]}),e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Yield"}),e.jsxs(m,{variant:"body1",paragraph:!0,children:[x," ",((f=t==null?void 0:t.yieldUnit)==null?void 0:f.name)||"servings"]}),e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Ingredients"}),e.jsx(fe,{children:i.map((g,F)=>{var le;return e.jsxs(be.Fragment,{children:[F>0&&e.jsx(J,{}),e.jsx(Ce,{children:e.jsx(Se,{primary:`${g.quantity} ${g.unit.name} ${((le=g.ingredient)==null?void 0:le.name)||""}`,secondary:g.note})})]},g.id)})}),!y&&(t==null?void 0:t.instructions)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Instructions"}),e.jsx("div",{dangerouslySetInnerHTML:{__html:t.instructions}})]})]})};if(h)return e.jsx(K,{sx:{mt:4,display:"flex",justifyContent:"center"},children:e.jsx(He,{})});if(l||!t||!t.recipeIngredients)return e.jsx(K,{sx:{mt:4},children:e.jsx(Ge,{severity:"error",children:l||"Recipe not found"})});d||t.recipeIngredients.map(i=>({id:i.id,quantity:i.quantity,unit:i.unit,ingredient:i.ingredient}));const re=(t.yieldQuantity||1)*p;return e.jsxs(K,{maxWidth:"xl",sx:{mt:2},children:[e.jsxs(Ye,{"aria-label":"breadcrumb",sx:{mb:2},children:[e.jsx(de,{component:ce,underline:"hover",color:"inherit",to:"/",children:"KitchenSync"}),e.jsx(de,{component:ce,underline:"hover",color:"inherit",to:"/recipes",children:"Recipes"}),e.jsx(m,{color:"text.primary",children:t==null?void 0:t.name})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsx(m,{variant:"h4",component:"h1",children:t==null?void 0:t.name}),e.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(T,{title:y?"Show Full Recipe":"Show Concise View",children:e.jsx(ct,{value:"concise",selected:y,onChange:()=>M(!y),size:"small",children:y?e.jsx(Ke,{}):e.jsx(ke,{})})}),e.jsx(T,{title:"Scale Recipe",children:e.jsx(z,{onClick:()=>D(!0),color:"primary",disabled:!!d,children:e.jsx(Ie,{})})}),e.jsx(T,{title:"Add to Prep Board",children:e.jsx(z,{onClick:De,color:"secondary",children:e.jsx(Je,{})})}),e.jsx(T,{title:"Edit Recipe",children:e.jsx(z,{onClick:()=>a(`/recipes/${t==null?void 0:t.id}/edit`),color:"primary",children:e.jsx(Xe,{})})}),e.jsx(T,{title:"Delete Recipe",children:e.jsx(z,{onClick:()=>O(!0),color:"error",children:e.jsx(Ze,{})})})]})]}),e.jsx(c,{sx:{mb:4,borderRadius:2,boxShadow:3,border:"1px solid #ddd",overflow:"hidden"},children:t.photoUrl?e.jsx("img",{src:t.photoUrl.startsWith("http")?t.photoUrl:`${window.location.origin}/${t.photoUrl}`,alt:t.name,style:{width:"100%",maxHeight:"500px",objectFit:"cover",display:"block"},onError:i=>{console.error("Image failed to load:",t.photoUrl);const x=i.target;!x.src.includes("/uploads/")&&t.photoUrl&&(x.src=`${window.location.origin}/uploads/${t.photoUrl.split("/").pop()}`)}}):e.jsx(c,{sx:{height:"300px",width:"100%",bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(m,{variant:"body1",color:"text.secondary",children:"No photo available"})})}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:[e.jsx(c,{sx:{flex:1,minWidth:d?"45%":"100%"},children:y?e.jsx(xe,{name:(t==null?void 0:t.name)||"",ingredients:(t==null?void 0:t.recipeIngredients)||[],yieldQuantity:(t==null?void 0:t.yieldQuantity)||1,yieldUnit:t!=null&&t.yieldUnit?{name:t.yieldUnit.name}:void 0}):e.jsx(ie,{ingredients:(t==null?void 0:t.recipeIngredients)||[],yield:(t==null?void 0:t.yieldQuantity)||1})}),d&&e.jsx(c,{sx:{flex:1,minWidth:"45%"},children:y?e.jsx(xe,{name:(t==null?void 0:t.name)||"",ingredients:d,yieldQuantity:re,yieldUnit:t!=null&&t.yieldUnit?{name:t.yieldUnit.name}:void 0,isScaled:!0,scaleFactor:p}):e.jsx(ie,{ingredients:d,yield:re,isScaled:!0})})]}),e.jsx(Rt,{open:v,onClose:()=>D(!1),onScale:_e,ingredients:t.recipeIngredients.map(i=>{var x;return{id:i.id,name:((x=i.ingredient)==null?void 0:x.name)||"",quantity:i.quantity,unit:{...i.unit,type:"VOLUME"}}})}),e.jsxs(E,{open:H,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(U,{children:"Add to Prep Board"}),e.jsxs(L,{children:[e.jsxs(me,{fullWidth:!0,sx:{mt:2,mb:2},children:[e.jsx(ge,{id:"prep-column-select-label",children:"Select Column"}),e.jsx(ye,{labelId:"prep-column-select-label",value:_,label:"Select Column",onChange:i=>se(i.target.value),children:k.map(i=>e.jsx(ve,{value:i.id,children:i.name},i.id))})]}),e.jsx(N,{fullWidth:!0,multiline:!0,rows:3,label:"Prep Notes",placeholder:"Add notes for this prep task",value:ae,onChange:i=>ne(i.target.value)})]}),e.jsxs(V,{children:[e.jsx(C,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(C,{onClick:Me,variant:"contained",color:"primary",disabled:!_,children:"Add to Prep Board"})]})]}),e.jsxs(E,{open:I,onClose:()=>b(!1),children:[e.jsx(U,{children:"Save Scaled Version?"}),e.jsx(L,{children:e.jsx(m,{children:"Are you sure you want to replace your base recipe with the scaled version? This action cannot be undone."})}),e.jsxs(V,{children:[e.jsx(C,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(C,{onClick:Be,variant:"contained",color:"primary",children:"Save as Base Recipe"})]})]}),e.jsxs(E,{open:P,onClose:()=>O(!1),children:[e.jsx(U,{children:"Delete Recipe?"}),e.jsx(L,{children:e.jsxs(m,{children:['Are you sure you want to delete "',t==null?void 0:t.name,'"? This action cannot be undone.']})}),e.jsxs(V,{children:[e.jsx(C,{onClick:()=>O(!1),children:"Cancel"}),e.jsx(C,{onClick:Pe,color:"error",variant:"contained",children:"Delete"})]})]})]})};export{Pt as default};
