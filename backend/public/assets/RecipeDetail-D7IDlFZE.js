import{i as U,r as W,j as e,a as o,D as E,b as B,c as z,B as c,R as ke,F as Q,d as A,e as g,T as L,f as de,I as ce,S as ue,M as he,g as G,h,k as O,P as pe,L as xe,l as me,m as je,n as ye,u as Me,o as Pe,p as Te,q as $e,C as H,s as Fe,A as qe,t as Ee,v as ie,w as re,x as C,y as Be,z as ze,E as D,G as Le,H as Oe,J as Ue,K as le,N as We,O as Ne}from"./index-DL2HdiZR.js";var Y={},Ve=U;Object.defineProperty(Y,"__esModule",{value:!0});var ve=Y.default=void 0,Qe=Ve(W()),Ae=e;ve=Y.default=(0,Qe.default)((0,Ae.jsx)("path",{d:"M14 11V8c4.56-.58 8-3.1 8-6H2c0 2.9 3.44 5.42 8 6v3c-3.68.73-8 3.61-8 11h6v-2H4.13c.93-6.83 6.65-7.2 7.87-7.2s6.94.37 7.87 7.2H16v2h6c0-7.39-4.32-10.27-8-11m-2 11c-1.1 0-2-.9-2-2 0-.55.22-1.05.59-1.41C11.39 17.79 16 16 16 16s-1.79 4.61-2.59 5.41c-.36.37-.86.59-1.41.59"}),"Scale");var K={},He=U;Object.defineProperty(K,"__esModule",{value:!0});var ge=K.default=void 0,Ge=He(W()),Ye=e;ge=K.default=(0,Ge.default)((0,Ye.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var J={},Ke=U;Object.defineProperty(J,"__esModule",{value:!0});var fe=J.default=void 0,Je=Ke(W()),Xe=e;fe=J.default=(0,Je.default)((0,Xe.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var X={},Ze=U;Object.defineProperty(X,"__esModule",{value:!0});var be=X.default=void 0,et=Ze(W()),tt=e;be=X.default=(0,et.default)((0,tt.jsx)("path",{d:"M19 5v14H5V5zm1.1-2H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9M11 7h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7z"}),"ListAlt");const nt=[2,3,4],st=[2,3,4],at=({open:r,onClose:a,onScale:t,ingredients:l})=>{var P;const[i,m]=o.useState("multiply"),[j,_]=o.useState(2),[b,M]=o.useState(2),[d,f]=o.useState(""),[x,k]=o.useState(""),[S,R]=o.useState(""),v=()=>{var T;let n;switch(i){case"multiply":n=d?parseFloat(d):j;break;case"divide":n=d?1/parseFloat(d):1/b;break;case"constraint":if(!x||!S)return;const w=l.find(N=>N.id===x);if(!w)return;n=parseFloat(S)/w.quantity;break;default:return}t({type:i,value:n,constraintIngredientId:i==="constraint"?Number(x):void 0,constraintQuantity:i==="constraint"?parseFloat(S):void 0,constraintUnitId:i==="constraint"&&x?(T=l.find(w=>w.id===x))==null?void 0:T.unit.id:void 0}),a()};return e.jsxs(E,{open:r,onClose:a,maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:"Scale Recipe"}),e.jsx(z,{children:e.jsxs(c,{sx:{pt:1},children:[e.jsxs(ke,{value:i,onChange:n=>{m(n.target.value),f("")},children:[e.jsx(Q,{value:"multiply",control:e.jsx(A,{}),label:"Multiply Recipe"}),i==="multiply"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsx(c,{sx:{display:"flex",gap:1,mb:1},children:nt.map(n=>e.jsxs(g,{variant:j===n&&!d?"contained":"outlined",onClick:()=>{_(n),f("")},size:"small",children:[n,"x"]},n))}),e.jsx(L,{label:"Custom multiplier",type:"number",value:d,onChange:n=>f(n.target.value),size:"small",inputProps:{min:"0",step:"0.25"}})]}),e.jsx(Q,{value:"divide",control:e.jsx(A,{}),label:"Divide Recipe"}),i==="divide"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsx(c,{sx:{display:"flex",gap:1,mb:1},children:st.map(n=>e.jsxs(g,{variant:b===n&&!d?"contained":"outlined",onClick:()=>{M(n),f("")},size:"small",children:["1/",n]},n))}),e.jsx(L,{label:"Custom divider",type:"number",value:d,onChange:n=>f(n.target.value),size:"small",inputProps:{min:"0",step:"0.25"}})]}),e.jsx(Q,{value:"constraint",control:e.jsx(A,{}),label:"Scale Based on Ingredient"}),i==="constraint"&&e.jsxs(c,{sx:{pl:4,mb:2},children:[e.jsxs(de,{fullWidth:!0,size:"small",sx:{mb:1},children:[e.jsx(ce,{children:"Base Ingredient"}),e.jsx(ue,{value:x,onChange:n=>k(n.target.value),label:"Base Ingredient",children:l.map(n=>e.jsxs(he,{value:n.id,children:[n.name," (",n.quantity," ",n.unit.name,")"]},n.id))})]}),x&&e.jsx(L,{label:"Desired Quantity",type:"number",value:S,onChange:n=>R(n.target.value),size:"small",fullWidth:!0,InputProps:{endAdornment:(P=l.find(n=>n.id===x))==null?void 0:P.unit.name},inputProps:{min:"0",step:"0.25"}})]})]}),e.jsx(G,{sx:{my:2}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Note: The scaling engine will intelligently round certain ingredients (like eggs) to maintain practical measurements while preserving the recipe's proportions."})]})}),e.jsxs(O,{children:[e.jsx(g,{onClick:a,children:"Cancel"}),e.jsx(g,{onClick:v,variant:"contained",disabled:i==="constraint"&&(!x||!S)||i!=="constraint"&&!d&&!j&&!b,children:"Scale Recipe"})]})]})},oe=({name:r,ingredients:a,yieldQuantity:t,yieldUnit:l,isScaled:i,scaleFactor:m})=>e.jsxs(pe,{sx:{p:2,height:"100%"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"baseline",mb:2,borderBottom:"2px solid",borderColor:"divider",pb:1},children:[e.jsxs(h,{variant:"h6",component:"h2",sx:{fontWeight:"bold"},children:[r,i&&` (${m}x)`]}),e.jsxs(h,{variant:"subtitle1",color:"text.secondary",children:["Yield: ",t," ",(l==null?void 0:l.name)||"servings"]})]}),e.jsx(xe,{dense:!0,disablePadding:!0,children:a.map((j,_)=>{var b;return e.jsxs(me.Fragment,{children:[_>0&&e.jsx(G,{}),e.jsx(je,{dense:!0,disableGutters:!0,children:e.jsx(ye,{primary:e.jsxs(h,{variant:"body2",sx:{fontFamily:"monospace"},children:[e.jsx(c,{component:"span",sx:{display:"inline-block",minWidth:"4rem"},children:j.quantity}),e.jsx(c,{component:"span",sx:{display:"inline-block",minWidth:"4rem"},children:j.unit.abbreviation||j.unit.name}),((b=j.ingredient)==null?void 0:b.name)||""]}),secondary:j.note,secondaryTypographyProps:{variant:"caption",sx:{fontStyle:"italic"}}})})]},j.id)})})]}),it=["egg","eggs","whole egg","whole eggs","banana","bananas","apple","apples","orange","oranges"],rt=[{decimal:.25,fraction:"1/4"},{decimal:.33,fraction:"1/3"},{decimal:.5,fraction:"1/2"},{decimal:.67,fraction:"2/3"},{decimal:.75,fraction:"3/4"}],lt=r=>{const a=r.name.toLowerCase();return it.some(t=>a.includes(t))||r.unit.type==="COUNT"},ot=r=>{if(r<.125)return r;const a=Math.floor(r),t=r-a;if(t<.125)return a;if(t>.875)return a+1;const l=rt.reduce((i,m)=>Math.abs(m.decimal-t)<Math.abs(i.decimal-t)?m:i);return a+l.decimal},dt=(r,a)=>lt(r)?Math.round(a):ot(a),ct=(r,a)=>{let t=a.value;if(a.type==="constraint"&&a.constraintIngredientId&&a.constraintQuantity){const l=r.find(i=>i.id===a.constraintIngredientId);l&&(t=a.constraintQuantity/l.quantity)}return r.map(l=>{const i=l.quantity*t,m=dt(l,i);return{...l,quantity:m,note:Math.abs(m-i)>.1?`Rounded from ${i.toFixed(2)}`:void 0}})},ht=()=>{const{id:r}=Me(),a=Pe(),[t,l]=o.useState(null),[i,m]=o.useState(null),[j,_]=o.useState(!0),[b,M]=o.useState(!1),[d,f]=o.useState(null),[x,k]=o.useState(1),[S,R]=o.useState(!1),[v,P]=o.useState(!1),{showSnackbar:n}=Te(),{addTask:T,columns:w}=$e(),[N,V]=o.useState(!1),[Se,$]=o.useState(!1),[F,Z]=o.useState(""),[ee,te]=o.useState("");o.useEffect(()=>{(async()=>{try{if(!r)throw new Error("Recipe ID is required");const u=await le(parseInt(r,10));l(u)}catch(u){m(u instanceof Error?u.message:"Failed to load recipe")}finally{_(!1)}})()},[r]);const Ie=s=>{if(!(t!=null&&t.recipeIngredients))return;const u=t.recipeIngredients.map(y=>{var p;return{id:y.id,name:((p=y.ingredient)==null?void 0:p.name)||"",quantity:y.quantity,unit:{...y.unit,type:"VOLUME"}}}),I=ct(u,s);f(t.recipeIngredients.map((y,p)=>({...y,quantity:I[p].quantity,note:I[p].note}))),k(s.value)},Ce=async()=>{var s,u;if(!(!t||!d))try{const I={name:t.name,description:t.description||"",instructions:t.instructions,yieldQuantity:(t.yieldQuantity||1)*x,yieldUnitId:((s=t.yieldUnit)==null?void 0:s.id)||1,prepTimeMinutes:t.prepTimeMinutes||0,cookTimeMinutes:t.cookTimeMinutes||0,categoryId:((u=t.category)==null?void 0:u.id)||1,tags:t.tags,ingredients:d.map(p=>{var q;return{type:"ingredient",ingredientId:(q=p.ingredient)==null?void 0:q.id,quantity:p.quantity,unitId:p.unit.id}})};await We(t.id,I);const y=await le(t.id);l(y),f(null),k(1),R(!1)}catch{m("Failed to save scaled version")}},Re=()=>{f(null),k(1)},we=()=>{Z(""),te(""),$(!0)},De=async()=>{if(!(!t||!F))try{const s=t.id?parseInt(t.id.toString(),10):void 0;await T({title:t.name,description:ee||t.description||"",columnId:F,recipeId:s}),$(!1),n("Recipe added to prep board","success")}catch(s){console.error("Error adding recipe to prep board:",s),n("Failed to add recipe to prep board","error")}},_e=async()=>{if(t!=null&&t.id)try{await Ne(t.id),n("Recipe deleted successfully","success"),a("/recipes")}catch(s){console.error("Error deleting recipe:",s),n("Failed to delete recipe","error")}},ne=({ingredients:s,yield:u,isScaled:I=!1})=>{var y;return e.jsxs(pe,{sx:{p:3,mb:3,height:"100%"},children:[I&&e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(h,{variant:"subtitle1",color:"primary",children:["Scaled Version (",x,"x)"]}),e.jsxs(c,{children:[e.jsx(C,{title:"Save as New Base Recipe",children:e.jsx(D,{onClick:()=>R(!0),color:"primary",size:"small",children:e.jsx(ge,{})})}),e.jsx(C,{title:"Close Scaled Version",children:e.jsx(D,{onClick:Re,size:"small",children:e.jsx(fe,{})})})]})]}),(t==null?void 0:t.description)&&!v&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(h,{variant:"body1",paragraph:!0,children:t.description})]}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Yield"}),e.jsxs(h,{variant:"body1",paragraph:!0,children:[u," ",((y=t==null?void 0:t.yieldUnit)==null?void 0:y.name)||"servings"]}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Ingredients"}),e.jsx(xe,{children:s.map((p,q)=>{var ae;return e.jsxs(me.Fragment,{children:[q>0&&e.jsx(G,{}),e.jsx(je,{children:e.jsx(ye,{primary:`${p.quantity} ${p.unit.name} ${((ae=p.ingredient)==null?void 0:ae.name)||""}`,secondary:p.note})})]},p.id)})}),!v&&(t==null?void 0:t.instructions)&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Instructions"}),e.jsx("div",{dangerouslySetInnerHTML:{__html:t.instructions}})]})]})};if(j)return e.jsx(H,{sx:{mt:4,display:"flex",justifyContent:"center"},children:e.jsx(Fe,{})});if(i||!t||!t.recipeIngredients)return e.jsx(H,{sx:{mt:4},children:e.jsx(qe,{severity:"error",children:i||"Recipe not found"})});d||t.recipeIngredients.map(s=>({id:s.id,quantity:s.quantity,unit:s.unit,ingredient:s.ingredient}));const se=(t.yieldQuantity||1)*x;return e.jsxs(H,{maxWidth:"xl",sx:{mt:2},children:[e.jsxs(Ee,{"aria-label":"breadcrumb",sx:{mb:2},children:[e.jsx(ie,{component:re,underline:"hover",color:"inherit",to:"/",children:"KitchenSync"}),e.jsx(ie,{component:re,underline:"hover",color:"inherit",to:"/recipes",children:"Recipes"}),e.jsx(h,{color:"text.primary",children:t==null?void 0:t.name})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsx(h,{variant:"h4",component:"h1",children:t==null?void 0:t.name}),e.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(C,{title:v?"Show Full Recipe":"Show Concise View",children:e.jsx(Be,{value:"concise",selected:v,onChange:()=>P(!v),size:"small",children:v?e.jsx(ze,{}):e.jsx(be,{})})}),e.jsx(C,{title:"Scale Recipe",children:e.jsx(D,{onClick:()=>M(!0),color:"primary",disabled:!!d,children:e.jsx(ve,{})})}),e.jsx(C,{title:"Add to Prep Board",children:e.jsx(D,{onClick:we,color:"secondary",children:e.jsx(Le,{})})}),e.jsx(C,{title:"Edit Recipe",children:e.jsx(D,{onClick:()=>a(`/recipes/${t==null?void 0:t.id}/edit`),color:"primary",children:e.jsx(Oe,{})})}),e.jsx(C,{title:"Delete Recipe",children:e.jsx(D,{onClick:()=>V(!0),color:"error",children:e.jsx(Ue,{})})})]})]}),e.jsx(c,{sx:{mb:4,borderRadius:2,boxShadow:3,border:"1px solid #ddd",overflow:"hidden"},children:t.photoUrl?e.jsx("img",{src:t.photoUrl.startsWith("http")?t.photoUrl:`${window.location.origin}/${t.photoUrl}`,alt:t.name,style:{width:"100%",maxHeight:"500px",objectFit:"cover",display:"block"},onError:s=>{console.error("Image failed to load:",t.photoUrl);const u=s.target;!u.src.includes("/uploads/")&&t.photoUrl&&(u.src=`${window.location.origin}/uploads/${t.photoUrl.split("/").pop()}`)}}):e.jsx(c,{sx:{height:"300px",width:"100%",bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{variant:"body1",color:"text.secondary",children:"No photo available"})})}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:[e.jsx(c,{sx:{flex:1,minWidth:d?"45%":"100%"},children:v?e.jsx(oe,{name:(t==null?void 0:t.name)||"",ingredients:(t==null?void 0:t.recipeIngredients)||[],yieldQuantity:(t==null?void 0:t.yieldQuantity)||1,yieldUnit:t!=null&&t.yieldUnit?{name:t.yieldUnit.name}:void 0}):e.jsx(ne,{ingredients:(t==null?void 0:t.recipeIngredients)||[],yield:(t==null?void 0:t.yieldQuantity)||1})}),d&&e.jsx(c,{sx:{flex:1,minWidth:"45%"},children:v?e.jsx(oe,{name:(t==null?void 0:t.name)||"",ingredients:d,yieldQuantity:se,yieldUnit:t!=null&&t.yieldUnit?{name:t.yieldUnit.name}:void 0,isScaled:!0,scaleFactor:x}):e.jsx(ne,{ingredients:d,yield:se,isScaled:!0})})]}),e.jsx(at,{open:b,onClose:()=>M(!1),onScale:Ie,ingredients:t.recipeIngredients.map(s=>{var u;return{id:s.id,name:((u=s.ingredient)==null?void 0:u.name)||"",quantity:s.quantity,unit:{...s.unit,type:"VOLUME"}}})}),e.jsxs(E,{open:Se,onClose:()=>$(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:"Add to Prep Board"}),e.jsxs(z,{children:[e.jsxs(de,{fullWidth:!0,sx:{mt:2,mb:2},children:[e.jsx(ce,{id:"prep-column-select-label",children:"Select Column"}),e.jsx(ue,{labelId:"prep-column-select-label",value:F,label:"Select Column",onChange:s=>Z(s.target.value),children:w.map(s=>e.jsx(he,{value:s.id,children:s.name},s.id))})]}),e.jsx(L,{fullWidth:!0,multiline:!0,rows:3,label:"Prep Notes",placeholder:"Add notes for this prep task",value:ee,onChange:s=>te(s.target.value)})]}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>$(!1),children:"Cancel"}),e.jsx(g,{onClick:De,variant:"contained",color:"primary",disabled:!F,children:"Add to Prep Board"})]})]}),e.jsxs(E,{open:S,onClose:()=>R(!1),children:[e.jsx(B,{children:"Save Scaled Version?"}),e.jsx(z,{children:e.jsx(h,{children:"Are you sure you want to replace your base recipe with the scaled version? This action cannot be undone."})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>R(!1),children:"Cancel"}),e.jsx(g,{onClick:Ce,variant:"contained",color:"primary",children:"Save as Base Recipe"})]})]}),e.jsxs(E,{open:N,onClose:()=>V(!1),children:[e.jsx(B,{children:"Delete Recipe?"}),e.jsx(z,{children:e.jsxs(h,{children:['Are you sure you want to delete "',t==null?void 0:t.name,'"? This action cannot be undone.']})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>V(!1),children:"Cancel"}),e.jsx(g,{onClick:_e,color:"error",variant:"contained",children:"Delete"})]})]})]})};export{ht as default};
